# Домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

## Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

План расчета
1. Сначала сделайте расчет всех необходимых ресурсов.
2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
5. Рассчитайте итоговые цифры.
6. В результате должно быть указано количество нод и их параметры.

---

Что бы не забыть, на лекции рассматривали установку кластера [kubernetes](https://github.com/aak74/kubernetes-for-beginners/tree/master/15-install/10-kubeadm)

## Ответ:

#### 1) Сначала сделайте расчет всех необходимых ресурсов.

| Components | CPU              | ОЗУ                |
|------------|------------------|--------------------|
| DB         | 1 * 3 = 3 core   | 4 * 3 = 12 Gb      |     
| Cache      | 1 * 3 = 3 core   | 4 * 3 = 12 Gb      | 
| Front      | 0,2 * 5 = 1 core | 0,05 * 5 = 0,25 Gb | 
| Back       | 1 * 10 = 10 core | 0,6 * 10 = 6 Gb    | 
| **Result** | **17 core**      | **31 Gb**          | 

---

#### 2) Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.

Есть статья с рекомендуемыми параметрами [Kubernetes Cluster Hardware Recommendations](https://docs.kublr.com/installation/hardware-recommendation/)

Для работы точно понадобится мастер нода, воркер с ControlPlane и логами и допустим еще 2 воркер ноды с нашими компонентами всего получается 4 ноды

|                                    | Master node         | ControlPlane Worker | Simple Worker x2   |
|------------------------------------|---------------------|---------------------|--------------------|
| Kublr-Kubernetes master components | 2 GB, 1.5 vCPU      |                     |                    | 
| Kublr-Kubernetes worker components |                     | 10.5 GB, 5.5 vCPU   | 10.5 GB, 5.5 vCPU  | 
| Feature: ControlPlane              |                     | 1.9GB, 1.2 vCPU     |                    | 
| Feature: Centralized monitoring    |                     | 5 GB, 1.2 vCPU      |                    |
| Feature: k8s core components       |                     | 0.5 GB, 0.15 vCPU   |                    |
| Feature: Centralized logging       |                     | 11GB, 1.4 vCPU      |                    |
| **Result**                         | **2 GB, 1.5 vCPU**  | **29 GB, 9.5 vCPU** | **21 GB, 11 vCPU** |

Уже нам потребуется 22 ядра и 52 оперативки

---

#### 3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.

Добавим еще два мастера и еще ControlPlane Worker уменьшим ресурсы worker т.к воркеров теперь больше

|                                    | Master node  x3    | ControlPlane Worker x3 | Simple Worker x2      |
|------------------------------------|--------------------|------------------------|-----------------------|
| Kublr-Kubernetes master components | 2 GB, 1.5 vCPU     |                        |                       | 
| Kublr-Kubernetes worker components |                    | 3.5 GB, 2 vCPU         | 7.75 GB, 4.25 vCPU    | 
| Feature: ControlPlane              |                    | 1.9GB, 1.2 vCPU        |                       | 
| Feature: Centralized monitoring    |                    | 5 GB, 1.2 vCPU         |                       |
| Feature: k8s core components       |                    | 0.5 GB, 0.15 vCPU      |                       |
| Feature: Centralized logging       |                    | 11GB, 1.4 vCPU         |                       |
| **Result**                         | **6 GB, 4.5 vCPU** | **65.7 GB, 18 vCPU**   | **15.5 GB, 8.5 vCPU** |

Уже нам потребуется 32 ядра и 88 оперативки

---

####  4) Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.

Заложили заранее

####  5. Рассчитайте итоговые цифры.
####  6. В результате должно быть указано количество нод и их параметры.

3-Master node: По 2 ядер и 2 Гб

3-ControlPlane Worker: По 6 ядер и 22 Гб

2-Worker: По 4 ядер и 8 Гб

Всего 8 нод из них 2 мастера и 5 воркера.

Общее кол-во ресурсов 32 CPU и 88 Гб ОЗУ